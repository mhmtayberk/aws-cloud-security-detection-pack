# False Positive Guidance

No detection rule is perfect. Legitimate administrative activity often resembles real-world attacks. This document provides guidance on handling common false positives (FPs) generated by these rules.

## The Reality of "High Fidelity"

We aim for high fidelity, but "high" is relative to your environment's baseline. A rule detecting `AttachAdminPolicy` is 100% accurate in its logic, but it will still fire when your Principal Engineer legally fixes a broken production role at 2 AM.

If you deploy these rules without tuning, you will receive alerts.

## Common Noise Sources

### 1. CI/CD & Infrastructure as Code (IaC)
Tools like Terraform, CloudFormation, and CDK regularly destroy and recreate resources.
- **Symptom:** Alerts for `DeleteSecurityGroup`, `DetachRolePolicy`, or `DeleteTrail` during deployment windows.
- **Fix:** Whitelist the ARN of your automation roles (`arn:aws:iam::*:role/TerraformRunner`).

### 2. "Break-Glass" / Emergency Access
During outages, legitimate admins may use the root account or bypass MFA to restore services.
- **Symptom:** `ConsoleLoginWithoutMFA` or `RootAccountUsage`.
- **Fix:** Do not auto-close these. Verify with the on-call engineer and document the exception.

### 3. Service-Linked Roles
AWS creates Service-Linked Roles (SLRs) to modify resources on your behalf.
- **Symptom:** `invokedBy: AWS Internal` events modifying security groups or policies.
- **Fix:** Most rules in this pack already exclude `invokedBy` sources. If one slips through, verify the `userIdentity.invokedBy` field.

## Tuning Strategy

**Do not delete the rule.** Tune it.

1.  **Identify the Actor:** Is it a human or a machine?
2.  **Define the Scope:** Is this behavior normal *for this specific role*?
3.  **Apply Filter:** Add a `NOT` condition to the query.

```sql
-- Example SQL exclusion
AND userIdentity.arn NOT LIKE '%/HashiCorp-Terraform-%'
```
